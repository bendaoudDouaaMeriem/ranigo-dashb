<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RaniGo - Vehicle Tracking</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  <style>
    :root {
      --primary-orange: #FF7F00;
      --primary-orange-hover: #FF9933;
      --primary-orange-light: rgba(255, 127, 0, 0.1);
      --dark-blue: #00264D;
      --light-blue: #004080;
      --light-blue-hover: #005cb3;
      --light-gray: #f8f9fa;
      --medium-gray: #e9ecef;
      --border-color: #dee2e6;
      --text-dark: #343a40;
      --text-medium: #6c757d;
      --text-light: #fff;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --info: #17a2b8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: var(--light-gray);
      color: var(--text-dark);
      font-size: 14px;
      line-height: 1.5;
    }

    .container {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 260px;
      background-color: var(--dark-blue);
      color: var(--text-light);
      padding: 0;
      transition: transform 0.3s ease;
      position: fixed;
      height: 100vh;
      z-index: 1000;
      overflow-y: auto;
    }

    .sidebar-header {
      padding: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      display: flex;
      align-items: center;
    }

    .logo-icon {
      width: 40px;
      height: 40px;
      background-color: var(--primary-orange);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 24px;
      margin-right: 12px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .logo-text {
      font-size: 20px;
      font-weight: bold;
    }

    .sidebar-subtitle {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.6);
      margin-top: 4px;
      margin-left: 52px;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: white;
      font-size: 18px;
      cursor: pointer;
    }

    .menu {
      margin-top: 20px;
      padding-bottom: 20px;
    }

    .menu-title {
      text-transform: uppercase;
      font-size: 11px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.5);
      padding: 10px 20px;
      margin-bottom: 5px;
      letter-spacing: 0.5px;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      border-left: 3px solid transparent;
    }

    .menu-item:hover {
      background-color: rgba(255, 255, 255, 0.05);
      border-left-color: var(--primary-orange);
    }

    .menu-item.active {
      background-color: rgba(255, 255, 255, 0.1);
      border-left-color: var(--primary-orange);
    }

    .menu-item i {
      margin-right: 12px;
      font-size: 16px;
      width: 20px;
      text-align: center;
    }

    /* Main Content Styles */
    .main-content {
      flex: 1;
      margin-left: 260px;
      transition: margin-left 0.3s ease;
    }

    .topbar {
      background-color: white;
      height: 70px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 25px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .topbar-left {
      display: flex;
      align-items: center;
    }

    .mobile-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 20px;
      margin-right: 15px;
      cursor: pointer;
      color: var(--text-dark);
    }

    .search-bar {
      display: flex;
      align-items: center;
      background-color: var(--light-gray);
      border-radius: 50px;
      padding: 8px 15px;
      width: 300px;
      border: 1px solid var(--border-color);
      transition: all 0.3s;
    }

    .search-bar:focus-within {
      box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.2);
      border-color: var(--primary-orange);
    }

    .search-bar i {
      color: var(--text-medium);
      margin-right: 10px;
    }

    .search-bar input {
      border: none;
      background: transparent;
      outline: none;
      flex: 1;
      font-size: 14px;
    }

    .topbar-right {
      display: flex;
      align-items: center;
    }

    .topbar-actions {
      display: flex;
      margin-right: 20px;
    }

    .action-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-medium);
      cursor: pointer;
      margin-left: 5px;
      position: relative;
      transition: background-color 0.2s;
    }

    .action-icon:hover {
      background-color: var(--light-gray);
    }

    .notification-badge {
      position: absolute;
      top: 5px;
      right: 5px;
      background-color: var(--danger);
      color: white;
      font-size: 10px;
      font-weight: bold;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-profile {
      display: flex;
      align-items: center;
      cursor: pointer;
      padding: 5px;
      border-radius: 50px;
      transition: background-color 0.2s;
    }

    .user-profile:hover {
      background-color: var(--light-gray);
    }

    .user-avatar {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      background-color: var(--primary-orange);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      margin-right: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-weight: 600;
      font-size: 14px;
    }

    .user-role {
      font-size: 12px;
      color: var(--text-medium);
    }

    .tracking {
      padding: 25px;
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      margin-bottom: 15px;
      font-size: 13px;
    }

    .breadcrumb a {
      color: var(--text-medium);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .breadcrumb .separator {
      margin: 0 8px;
      color: var(--text-medium);
    }

    .breadcrumb .current {
      color: var(--text-dark);
      font-weight: 500;
    }

    .tracking-header {
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
    }

    .tracking-title-wrapper {
      flex: 1;
    }

    .tracking-title {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 8px;
      color: var(--text-dark);
    }

    .tracking-subtitle {
      color: var(--text-medium);
      font-size: 14px;
    }

    .tracking-actions {
      display: flex;
      gap: 10px;
    }

    .btn {
      padding: 8px 16px;
      border-radius: 5px;
      font-weight: 500;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      border: none;
    }

    .btn i {
      margin-right: 8px;
    }

    .btn-primary {
      background-color: var(--primary-orange);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-orange-hover);
      box-shadow: 0 4px 10px rgba(255, 127, 0, 0.25);
    }

    .btn-secondary {
      background-color: white;
      color: var(--text-dark);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background-color: var(--light-gray);
    }

    .map-container {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 20px;
      margin-bottom: 25px;
      height: calc(100vh - 230px);
      min-height: 400px;
    }

    .map-section {
      background-color: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      border: 1px solid var(--border-color);
      display: flex;
      flex-direction: column;
    }

    .card-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    .map-controls {
      display: flex;
      gap: 8px;
    }

    .map-control-btn {
      padding: 6px 12px;
      border-radius: 50px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid var(--border-color);
      background-color: white;
      transition: all 0.2s;
    }

    .map-control-btn:hover {
      background-color: var(--light-gray);
    }

    .map-control-btn.active {
      background-color: var(--primary-orange);
      color: white;
      border-color: var(--primary-orange);
    }

    .map {
      flex: 1;
      position: relative;
      overflow: hidden;
    }

    #tracking-map {
      height: 100%;
      width: 100%;
      z-index: 1;
    }

    .map-overlay {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: rgba(255, 255, 255, 0.8);
      border-radius: 5px;
      padding: 10px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      z-index: 2;
    }

    .map-legend {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      font-size: 12px;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      margin-right: 5px;
    }

    .legend-available {
      background-color: var(--success);
    }

    .legend-in-use {
      background-color: var(--info);
    }

    .legend-maintenance {
      background-color: var(--warning);
    }

    .legend-charging {
      background-color: var(--primary-orange);
    }

    .legend-escooter {
      background-color: var(--primary-orange);
      border: 2px solid white;
    }

    .legend-ebike {
      background-color: var(--info);
      border: 2px solid white;
    }

    .sidebar-panel {
      display: flex;
      flex-direction: column;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      overflow: hidden;
      border: 1px solid var(--border-color);
    }

    .panel-tabs {
      display: flex;
      border-bottom: 1px solid var(--border-color);
    }

    .panel-tab {
      flex: 1;
      text-align: center;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
      font-weight: 500;
    }

    .panel-tab.active {
      border-bottom-color: var(--primary-orange);
      color: var(--primary-orange);
    }

    .panel-tab:hover:not(.active) {
      background-color: var(--light-gray);
    }

    .tab-content {
      flex: 1;
      overflow-y: auto;
      background-color: white;
    }

    .tab-pane {
      display: none;
      padding: 15px;
      height: 100%;
    }

    .tab-pane.active {
      display: block;
    }

    .vehicles-list {
      overflow-y: auto;
      max-height: 100%;
    }

    .vehicle-item {
      display: flex;
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
      transition: all 0.2s;
      cursor: pointer;
    }

    .vehicle-item:hover {
      background-color: var(--light-gray);
    }

    .vehicle-item:last-child {
      border-bottom: none;
    }

    .vehicle-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-right: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .vehicle-icon.escooter {
      background-color: rgba(255, 127, 0, 0.1);
      color: var(--primary-orange);
    }

    .vehicle-icon.ebike {
      background-color: rgba(23, 162, 184, 0.1);
      color: var(--info);
    }

    .vehicle-details {
      flex: 1;
    }

    .vehicle-title {
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .vehicle-info {
      font-size: 12px;
      color: var(--text-medium);
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .vehicle-location {
      font-size: 12px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .status-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 5px;
    }

    .status-available {
      background-color: var(--success);
    }

    .status-in-use {
      background-color: var(--info);
    }

    .status-maintenance {
      background-color: var(--warning);
    }

    .status-charging {
      background-color: var(--primary-orange);
    }

    .history-list {
      height: 100%;
      overflow-y: auto;
    }

    .history-item {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border-color);
    }

    .history-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
    }

    .history-id {
      font-weight: 600;
    }

    .history-time {
      font-size: 12px;
      color: var(--text-medium);
    }

    .history-content {
      font-size: 13px;
      color: var(--text-medium);
    }

    .alert-section {
      margin-top: 20px;
    }

    .alert-item {
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 10px;
      font-size: 13px;
      border-left: 4px solid;
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .alert-item.alert-warning {
      background-color: rgba(255, 193, 7, 0.1);
      border-left-color: var(--warning);
    }

    .alert-item.alert-danger {
      background-color: rgba(220, 53, 69, 0.1);
      border-left-color: var(--danger);
    }

    .alert-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .alert-icon.warning {
      background-color: rgba(255, 193, 7, 0.1);
      color: var(--warning);
    }

    .alert-icon.danger {
      background-color: rgba(220, 53, 69, 0.1);
      color: var(--danger);
    }

    .alert-content {
      flex: 1;
    }

    .alert-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .alert-info {
      color: var(--text-medium);
      font-size: 12px;
    }

    .search-vehicle {
      padding: 8px 12px;
      border-radius: 4px;
      border: 1px solid var(--border-color);
      margin-bottom: 10px;
      width: 100%;
      font-size: 13px;
    }

    .search-vehicle:focus {
      outline: none;
      border-color: var(--primary-orange);
      box-shadow: 0 0 0 2px rgba(255, 127, 0, 0.1);
    }

    .filter-options {
      display: flex;
      margin-bottom: 10px;
      overflow-x: auto;
      gap: 5px;
    }

    .filter-option {
      padding: 5px 10px;
      font-size: 12px;
      border-radius: 20px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.2s;
      background-color: var(--light-gray);
    }

    .filter-option.active {
      background-color: var(--primary-orange);
      color: white;
    }

    .no-results {
      text-align: center;
      padding: 20px;
      color: var(--text-medium);
      font-style: italic;
    }

    .battery-level {
      width: 100%;
      height: 4px;
      background-color: var(--light-gray);
      border-radius: 2px;
      margin-top: 5px;
      overflow: hidden;
    }

    .battery-fill {
      height: 100%;
      border-radius: 2px;
    }

    .battery-high {
      background-color: var(--success);
    }

    .battery-medium {
      background-color: var(--warning);
    }

    .battery-low {
      background-color: var(--danger);
    }

    .battery-text {
      font-size: 11px;
      display: flex;
      justify-content: space-between;
      margin-top: 2px;
    }

    .drawer {
      position: fixed;
      top: 0;
      right: -400px;
      width: 400px;
      height: 100vh;
      background-color: white;
      box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
      z-index: 1100;
      transition: right 0.3s ease;
      display: flex;
      flex-direction: column;
      max-width: 100%;
    }

    .drawer.open {
      right: 0;
    }

    .drawer-header {
      padding: 20px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .drawer-title {
      font-size: 18px;
      font-weight: 600;
    }

    .drawer-close {
      background: none;
      border: none;
      font-size: 18px;
      cursor: pointer;
      color: var(--text-medium);
      width: 30px;
      height: 30px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .drawer-close:hover {
      background-color: var(--light-gray);
      color: var(--text-dark);
    }

    .drawer-body {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
    }

    .drawer-actions {
      padding: 15px 20px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }

    .drawer-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 1050;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .drawer-backdrop.show {
      opacity: 1;
      visibility: visible;
    }

    .vehicle-detail-section {
      margin-bottom: 20px;
    }

    .detail-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 10px;
      color: var(--text-dark);
    }

    .detail-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
    }

    .detail-item {
      display: flex;
      flex-direction: column;
    }

    .detail-label {
      font-size: 12px;
      color: var(--text-medium);
      margin-bottom: 5px;
    }

    .detail-value {
      font-weight: 500;
      font-size: 14px;
    }

    .status-badge {
      display: inline-flex;
      align-items: center;
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .status-badge.available {
      background-color: rgba(40, 167, 69, 0.1);
      color: var(--success);
    }

    .status-badge.in-use {
      background-color: rgba(23, 162, 184, 0.1);
      color: var(--info);
    }

    .status-badge.maintenance {
      background-color: rgba(255, 193, 7, 0.1);
      color: var(--warning);
    }

    .status-badge.charging {
      background-color: rgba(255, 127, 0, 0.1);
      color: var(--primary-orange);
    }

    .timeline {
      margin-left: 15px;
      border-left: 2px solid var(--border-color);
      padding: 0 0 0 20px;
    }

    .timeline-item {
      position: relative;
      margin-bottom: 20px;
    }

    .timeline-item:last-child {
      margin-bottom: 0;
    }

    .timeline-item:before {
      content: '';
      position: absolute;
      left: -26px;
      top: 0;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background-color: var(--primary-orange);
      border: 2px solid white;
    }

    .timeline-time {
      font-size: 12px;
      color: var(--text-medium);
      margin-bottom: 5px;
    }

    .timeline-content {
      font-size: 14px;
      background-color: var(--light-gray);
      padding: 10px;
      border-radius: 5px;
    }

    .activity-heading {
      font-size: 14px;
      font-weight: 600;
      margin: 20px 0 15px;
    }

    @media (max-width: 992px) {
      .map-container {
        grid-template-columns: 1fr;
        grid-template-rows: 1fr 300px;
        gap: 15px;
        height: auto;
      }

      .map-section {
        height: 400px;
      }

      .sidebar-panel {
        height: 300px;
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 240px;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-toggle {
        display: block;
      }

      .search-bar {
        width: 200px;
      }

      .topbar-actions {
        margin-right: 10px;
      }

      .user-info {
        display: none;
      }

      .tracking-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .tracking-actions {
        width: 100%;
      }

      .btn {
        flex: 1;
        justify-content: center;
      }

      .drawer {
        width: 320px;
      }
    }

    @media (max-width: 576px) {
      .search-bar {
        display: none;
      }

      .btn {
        padding: 8px 10px;
      }

      .btn i {
        margin-right: 5px;
      }

      .drawer {
        width: 100%;
      }
    }

    a.menu-item {
      text-decoration: none;
      color: inherit;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    a.menu-item:hover {
      background-color: #f0f0f0;
      /* Optional hover effect */
    }
    #vehicle-map-picker {
  border-radius: 5px;
  border: 1px solid var(--border-color);
  margin-bottom: 15px;
}

.map-instructions {
  font-size: 13px;
  color: var(--text-medium);
  margin-bottom: 10px;
}

.grid-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

@media (max-width: 768px) {
  .grid-container {
    grid-template-columns: 1fr;
  }
}
.logo-image {
  height: 70px;
  width: auto;
  max-width: 150px;
  object-fit: contain;
}
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth-compat.js"></script>
</head>

<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <img src="logo.jpg.png" alt="RaniGo Logo" class="logo-image">  </div>
        <button class="menu-toggle">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <nav class="menu">
        <div class="menu-title">Main</div>
        <a href="admin.html" class="menu-item">
          <i class="fas fa-tachometer-alt"></i>
          <span>Dashboard</span>
        </a>

        <div class="menu-title">Management</div>
        <a href="maintenance.html" class="menu-item">
          <i class="fas fa-tools"></i>
          <span>Maintenance</span>
        </a>

        <a href="parking_zones.html" class="menu-item">
          <i class="fas fa-map-marker-alt"></i>
          <span>Parking Zones</span>
        </a>
        <a href="tracking.html" class="menu-item active">
          <i class="fas fa-map-marked-alt"></i>
          <span>Tracking</span>
        </a>
        <div class="menu-title">Settings</div>
        <a href="settings.html" class="menu-item">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <div class="topbar">
        <div class="topbar-right">
          <div class="user-profile">
            <div class="user-avatar" id="adminInitials">AD</div>
            <div class="user-info">
              <div class="user-name" id="name">Admin</div>
              <div class="user-role" id="role">Administrator</div>
            </div>
          </div>
        </div>
      </div>

      <div class="tracking">
        <div class="breadcrumb">
          <a href="#">Dashboard</a>
          <span class="separator"><i class="fas fa-chevron-right"></i></span>
          <span class="current">Vehicle Tracking</span>
        </div>

        <div class="tracking-header">
          <div class="tracking-title-wrapper">
            <h1 class="tracking-title">Vehicle Tracking</h1>
            <p class="tracking-subtitle">Monitor and manage your fleet in real-time</p>
          </div>
          <div class="tracking-actions">
            <button class="btn btn-secondary" id="refresh-btn">
              <i class="fas fa-sync"></i> Refresh
            </button>
            <button class="btn btn-primary" id="add-vehicle-btn">
              <i class="fas fa-plus"></i> Add Vehicle
            </button>
          </div>
        </div>

        <div class="map-container">
          <div class="map-section">
            <div class="card-header">
              <h2 class="card-title">Live Tracking Map</h2>
              <div class="map-controls">
                <button class="map-control-btn active" data-filter="all">All</button>
                <button class="map-control-btn" data-filter="escooter">e-Scooters</button>
                <button class="map-control-btn" data-filter="ebike">e-Bikes</button>
              </div>
            </div>
            <div class="map">
              <div id="tracking-map"></div>
              <div class="map-overlay">
                <div class="map-legend">
                  <div class="legend-item">
                    <span class="legend-color legend-available"></span>
                    <span>Available</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color legend-in-use"></span>
                    <span>In Use</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color legend-maintenance"></span>
                    <span>Maintenance</span>
                  </div>
                  <div class="legend-item">
                    <span class="legend-color legend-charging"></span>
                    <span>Charging</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="sidebar-panel">
            <div class="panel-tabs">
              <div class="panel-tab active" data-tab="vehicles">Vehicles (<span id="total-vehicles">0</span>)</div>
              <div class="panel-tab" data-tab="history">Location History</div>
            </div>
            <div class="tab-content">
              <div class="tab-pane active" id="vehicles-tab">
                <input type="text" class="search-vehicle" placeholder="Search vehicles...">
                <div class="filter-options">
                  <div class="filter-option active" data-filter="all">All</div>
                  <div class="filter-option" data-filter="Available">Available</div>
                  <div class="filter-option" data-filter="In Use">In Use (<span id="active-rides">0</span>)</div>
                  <div class="filter-option" data-filter="Maintenance">Maintenance (<span id="maintenance-vehicles">0</span>)</div>
                  <div class="filter-option" data-filter="Charging">Charging</div>
                </div>
                <div class="vehicles-list" id="vehicles-list">
                  <!-- Vehicles will be loaded here dynamically -->
                  <div class="no-results">Loading vehicles...</div>
                </div>
              </div>
              <div class="tab-pane" id="history-tab">
                <div class="history-list" id="history-list">
                  <!-- History will be loaded here dynamically -->
                  <div class="no-results">Loading location history...</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="alert-section">
          <div class="alert-item alert-warning">
            <div class="alert-icon warning">
              <i class="fas fa-exclamation-triangle"></i>
            </div>
            <div class="alert-content">
              <div class="alert-title">Low Battery Alerts</div>
              <div class="alert-info" id="low-battery-alert">Loading battery information...</div>
            </div>
          </div>
          <div class="alert-item alert-danger">
            <div class="alert-icon danger">
              <i class="fas fa-exclamation-circle"></i>
            </div>
            <div class="alert-content">
              <div class="alert-title">Maintenance Required</div>
              <div class="alert-info" id="maintenance-alert">Loading maintenance information...</div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Vehicle Details Drawer -->
  <div class="drawer" id="vehicle-details-drawer">
    <div class="drawer-header">
      <h2 class="drawer-title">Vehicle Details</h2>
      <button class="drawer-close" id="close-drawer">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="drawer-body">
      <div class="vehicle-detail-section">
        <h3 class="detail-title">Basic Information</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <div class="detail-label">Serial Number</div>
            <div class="detail-value" id="detail-serial">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Type</div>
            <div class="detail-value" id="detail-type">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Status</div>
            <div class="detail-value" id="detail-status">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Battery</div>
            <div class="detail-value" id="detail-battery">-</div>
          </div>
        </div>
      </div>

      <div class="vehicle-detail-section">
        <h3 class="detail-title">Location Information</h3>
        <div class="detail-grid">
          <div class="detail-item">
            <div class="detail-label">Current Location</div>
            <div class="detail-value" id="detail-location">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Last Updated</div>
            <div class="detail-value" id="detail-last-updated">-</div>
          </div>
          <div class="detail-item">
            <div class="detail-label">Coordinates</div>
            <div class="detail-value" id="detail-coordinates">-</div>
          </div>
        </div>
      </div>

      <h3 class="activity-heading">Recent Activity</h3>
      <div class="timeline" id="vehicle-timeline">
        <!-- Timeline items will be loaded here dynamically -->
        <div class="no-results">No recent activity found</div>
      </div>
    </div>
    <div class="drawer-actions">
      <button class="btn btn-secondary" id="view-history-btn">View History</button>
      <button class="btn btn-primary" id="update-status-btn">Update Status</button>
    </div>
  </div>
  <div class="drawer-backdrop" id="drawer-backdrop"></div>
  <!-- Add Vehicle Drawer -->
  <!-- Add Vehicle Drawer -->
  <div class="drawer" id="add-vehicle-drawer">
    <div class="drawer-header">
      <h2 class="drawer-title">Add New Vehicle</h2>
      <button class="drawer-close" id="close-add-drawer"><i class="fas fa-times"></i></button>
    </div>
    <div class="drawer-body">
      <form id="add-vehicle-form">
        <div class="vehicle-detail-section">
          <div class="form-group">
            <label class="form-label">Serial Number</label>
            <input type="text" id="add-serial" class="form-control" required>
          </div>
  
          <div class="form-group">
            <label class="form-label">Vehicle Type</label>
            <select id="add-type" class="form-control" required>
              <option value="scooter">Scooter</option>
              <option value="bike">Bike</option>
            </select>
          </div>
  
          <div class="form-group">
            <label class="form-label">Battery Level (%)</label>
            <input type="number" id="add-battery" class="form-control" min="0" max="100" required>
          </div>
  
          <div class="form-group">
            <label class="form-label">Status</label>
            <select id="add-status" class="form-control" required>
              <option value="Available">Available</option>
              <option value="In Use">In Use</option>
              <option value="Maintenance">Maintenance</option>
              <option value="Charging">Charging</option>
            </select>
          </div>
  
          <div class="form-group">
            <label class="form-label">Location Description</label>
            <input type="text" id="add-location" class="form-control" required>
          </div>
  
          <div class="map-instructions">
            <i class="fas fa-info-circle"></i> Click on the map to select vehicle location
          </div>
          <div id="vehicle-map-picker" style="height: 300px; margin-bottom: 15px;"></div>
  
          <div class="grid-container">
            <div class="form-group">
              <label class="form-label">Latitude</label>
              <input type="number" step="any" id="add-latitude" class="form-control" required readonly>
            </div>
            <div class="form-group">
              <label class="form-label">Longitude</label>
              <input type="number" step="any" id="add-longitude" class="form-control" required readonly>
            </div>
          </div>
        </div>
      </form>
    </div>
    <div class="drawer-actions">
      <button class="btn btn-secondary" id="cancel-add">Cancel</button>
      <button class="btn btn-primary" type="submit" form="add-vehicle-form">Save</button>
    </div>
  </div>
  <div class="drawer-backdrop" id="add-drawer-backdrop"></div>


 <script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyBRbRm4b1Un7vI4GkW1F-k8IiPRBTK737o",
    authDomain: "final-b9978.firebaseapp.com",
    projectId: "final-b9978",
    storageBucket: "final-b9978.appspot.com",
    messagingSenderId: "915317228274",
    appId: "1:915317228274:web:6db702d37759d74d4d066b",
    measurementId: "G-VVH5GXQ3RC"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const auth = firebase.auth();

  // Global variables
  let map;
  let vehicleMapPicker;
  let vehiclePickerMarker;
  const vehicleMarkers = {};
  let allVehicles = [];
  let locationHistory = [];
  let selectedVehicleId = null;

  $(document).ready(function () {
    // Initialize maps
    initMainMap();
    setupEventListeners();

    // Check authentication state
    auth.onAuthStateChanged(function (user) {
      if (user) {
        const uid = user.uid;
        fetchAdminData(uid);
        loadVehicles();
        loadLocationHistory();
      } else {
        window.location.href = 'login.html';
      }
    });
  });

  function initMainMap() {
    map = L.map('tracking-map').setView([40.7128, -74.0060], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
  }

  function initVehicleMapPicker() {
    vehicleMapPicker = L.map('vehicle-map-picker').setView([40.7128, -74.0060], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(vehicleMapPicker);

    vehicleMapPicker.on('click', function (e) {
      const lat = e.latlng.lat;
      const lng = e.latlng.lng;

      $('#add-latitude').val(lat.toFixed(6));
      $('#add-longitude').val(lng.toFixed(6));

      if (vehiclePickerMarker) {
        vehiclePickerMarker.setLatLng(e.latlng);
      } else {
        vehiclePickerMarker = L.marker(e.latlng).addTo(vehicleMapPicker);
      }
    });
  }

  function setupEventListeners() {
    // Add vehicle button
    $('#add-vehicle-btn').on('click', openAddVehicleDrawer);

    // Close add vehicle drawer
    $('#close-add-drawer, #cancel-add, #add-drawer-backdrop').on('click', closeAddVehicleDrawer);

    // Form submission
    $('#add-vehicle-form').on('submit', handleAddVehicleSubmit);

    // Panel tab switching
    $('.panel-tab').on('click', function () {
      const tab = $(this).data('tab');
      $('.panel-tab').removeClass('active');
      $(this).addClass('active');
      $('.tab-pane').removeClass('active');
      $(`#${tab}-tab`).addClass('active');
    });

    // Vehicle filtering
    $('.filter-option').on('click', function () {
      const filter = $(this).data('filter');
      $('.filter-option').removeClass('active');
      $(this).addClass('active');

      $('.vehicle-item').each(function () {
        const $item = $(this);
        const status = $item.find('.vehicle-title span:last-child').text().trim();
        const type = $item.find('.vehicle-icon').hasClass('scooter') ? 'scooter' : 'bike';

        const showItem =
          (filter === 'all') ||
          (filter === status) ||
          (filter === 'scooter' && type === 'scooter') ||
          (filter === 'bike' && type === 'bike');

        $item.toggle(showItem);
      });
    });

    // Map type filtering
    $('.map-control-btn').on('click', function () {
      const filter = $(this).data('filter');
      $('.map-control-btn').removeClass('active');
      $(this).addClass('active');

      Object.values(vehicleMarkers).forEach(marker => {
        const vehicleId = Object.keys(vehicleMarkers).find(
          key => vehicleMarkers[key] === marker
        );
        const vehicle = allVehicles.find(v => v.id === vehicleId);

        if (!vehicle) return;

        const type = vehicle.type.toLowerCase();
        const showMarker =
          filter === 'all' ||
          (filter === 'scooter' && type === 'scooter') ||
          (filter === 'bike' && type === 'bike');

        if (showMarker) {
          map.addLayer(marker);
        } else {
          map.removeLayer(marker);
        }
      });
    });

    // Vehicle search
    $('.search-vehicle').on('input', function () {
      const searchTerm = $(this).val().toLowerCase();

      $('.vehicle-item').each(function () {
        const text = $(this).text().toLowerCase();
        $(this).toggle(text.includes(searchTerm));
      });
    });

    // Refresh button
    $('#refresh-btn').on('click', function () {
      loadVehicles();
      loadLocationHistory();
    });

    // Close drawer
    $('#close-drawer, #drawer-backdrop').on('click', function () {
      $('#vehicle-details-drawer').removeClass('open');
      $('#drawer-backdrop').removeClass('show');
    });

    // View history button
    $('#view-history-btn').on('click', function () {
      if (selectedVehicleId) {
        $('.panel-tab[data-tab="history"]').click();
      }
    });

    // Update status button
    $('#update-status-btn').on('click', function () {
      if (selectedVehicleId) {
        alert('Status update functionality would be implemented here');
      }
    });

    // Mobile menu toggle
    $('.mobile-toggle').on('click', function () {
      $('.sidebar').toggleClass('open');
    });

    // Window resize handler
    $(window).on('resize', function () {
      map.invalidateSize();
      if (vehicleMapPicker) vehicleMapPicker.invalidateSize();
    });
  }

  function openAddVehicleDrawer() {
    $('#add-vehicle-drawer').addClass('open');
    $('#add-drawer-backdrop').addClass('show');

    setTimeout(() => {
      if (!vehicleMapPicker) {
        initVehicleMapPicker();
      } else {
        vehicleMapPicker.invalidateSize();
      }
    }, 10);
  }

  function closeAddVehicleDrawer() {
    $('#add-vehicle-drawer').removeClass('open');
    $('#add-drawer-backdrop').removeClass('show');
    $('#add-vehicle-form')[0].reset();
    if (vehiclePickerMarker) {
      vehicleMapPicker.removeLayer(vehiclePickerMarker);
      vehiclePickerMarker = null;
    }
  }

  async function handleAddVehicleSubmit(e) {
    e.preventDefault();

    const serial_number = $('#add-serial').val();
    const type = $('#add-type').val();
    const battery = parseInt($('#add-battery').val(), 10);
    const status = $('#add-status').val();
    const location = $('#add-location').val();
    const latitude = parseFloat($('#add-latitude').val());
    const longitude = parseFloat($('#add-longitude').val());

    if (!latitude || !longitude) {
      alert('Please select a location on the map');
      return;
    }

    const newVehicle = {
      serial_number,
      type,
      battery_level: battery,
      status,
      location,
      last_latitude: latitude,
      last_longitude: longitude,
      last_updated: firebase.firestore.FieldValue.serverTimestamp()
    };

    try {
      await db.collection('vehicles').add(newVehicle);
      alert('Vehicle added successfully!');
      closeAddVehicleDrawer();
      loadVehicles();
    } catch (err) {
      console.error("Error adding vehicle:", err);
      alert("Error adding vehicle: " + err.message);
    }
  }

  async function fetchAdminData(uid) {
    try {
      const adminDoc = await db.collection('admins').doc(uid).get();

      if (adminDoc.exists) {
        const adminData = adminDoc.data();
        $('#name').text(adminData.name);
        $('#role').text(adminData.role);

        const nameParts = adminData.name.split(' ');
        const initials = nameParts.length >= 2
          ? (nameParts[0][0] + nameParts[1][0]).toUpperCase()
          : nameParts[0].substring(0, 2).toUpperCase();

        $('#adminInitials').text(initials);
      } else {
        console.error("No admin document found for UID:", uid);
      }
    } catch (error) {
      console.error("Error fetching admin data:", error);
    }
  }

  function loadVehicles() {
    db.collection('vehicles').get()
      .then(querySnapshot => {
        allVehicles = [];
        $('#vehicles-list').empty();

        // Clear existing markers
        Object.values(vehicleMarkers).forEach(marker => map.removeLayer(marker));
        Object.keys(vehicleMarkers).forEach(key => delete vehicleMarkers[key]);

        if (querySnapshot.empty) {
          $('#vehicles-list').html('<div class="no-results">No vehicles found</div>');
          return;
        }

        querySnapshot.forEach(doc => {
          const vehicle = doc.data();
          vehicle.id = doc.id;
          allVehicles.push(vehicle);

          renderVehicleItem(vehicle);

          if (vehicle.last_latitude && vehicle.last_longitude) {
            addVehicleMarker(vehicle);
          }
        });

        updateVehicleCounters();
        updateAlerts();
      })
      .catch(error => {
        console.error('Error loading vehicles:', error);
        $('#vehicles-list').html('<div class="no-results">Error loading vehicles</div>');
      });
  }

  function loadLocationHistory() {
    db.collection('vehicle_history')
      .orderBy('timestamp', 'desc')
      .limit(50)
      .get()
      .then(querySnapshot => {
        locationHistory = [];
        $('#history-list').empty();

        if (querySnapshot.empty) {
          $('#history-list').html('<div class="no-results">No location history available</div>');
          return;
        }

        querySnapshot.forEach(doc => {
          const historyItem = doc.data();
          historyItem.id = doc.id;
          locationHistory.push(historyItem);
          renderHistoryItem(historyItem);
        });
      })
      .catch(error => {
        console.error('Error loading location history:', error);
        $('#history-list').html('<div class="no-results">Error loading history</div>');
      });
  }

  function renderVehicleItem(vehicle) {
    const batteryClass = getBatteryClass(vehicle.battery_level || vehicle.battery || 0);
    const vehicleType = (vehicle.type || vehicle.vehicle_type || 'escooter').toLowerCase();

    const vehicleItem = $(`
      <div class="vehicle-item" data-vehicle-id="${vehicle.id}" 
           data-lat="${vehicle.last_latitude || ''}" 
           data-lng="${vehicle.last_longitude || ''}">
        <div class="vehicle-icon ${vehicleType}">
          <i class="fas fa-${vehicleType === 'scooter' ? 'motorcycle' : 'bicycle'}"></i>
        </div>
        <div class="vehicle-details">
          <div class="vehicle-title">
            <span>${vehicle.serial_number}</span>
            <span>
              <span class="status-indicator status-${(vehicle.status || '').toLowerCase().replace(' ', '-')}"></span>
              ${vehicle.status || 'Unknown'}
            </span>
          </div>
          <div class="vehicle-info">
            <div class="vehicle-location">
              <i class="fas fa-map-marker-alt"></i> ${vehicle.location || 'Unknown location'}
            </div>
            <div class="battery-level">
              <div class="battery-fill ${batteryClass}" style="width: ${vehicle.battery_level || vehicle.battery || 0}%;"></div>
            </div>
            <div class="battery-text">
              <span>Battery</span>
              <span>${vehicle.battery_level || vehicle.battery || 0}%</span>
            </div>
          </div>
        </div>
      </div>
    `);

    vehicleItem.on('click', () => showVehicleDetails(vehicle));
    $('#vehicles-list').append(vehicleItem);
  }

  function renderHistoryItem(historyItem) {
    const timestamp = historyItem.timestamp?.toDate() || new Date();
    const formattedTime = formatTime(timestamp);

    const historyElement = $(`
      <div class="history-item" data-lat="${historyItem.latitude}" data-lng="${historyItem.longitude}">
        <div class="history-header">
          <div class="history-id">${historyItem.serial_number}</div>
          <div class="history-time">${formattedTime}</div>
        </div>
        <div class="history-content">
          <div>Location: ${historyItem.latitude}, ${historyItem.longitude}</div>
          <div>Battery: ${historyItem.battery_level}%</div>
        </div>
      </div>
    `);

    historyElement.on('click', () => {
      map.setView([historyItem.latitude, historyItem.longitude], 16);
    });

    $('#history-list').append(historyElement);
  }

  function addVehicleMarker(vehicle) {
    const status = (vehicle.status || '').toLowerCase();
    let color = '#28a745'; // Available

    if (status.includes('in use')) color = '#17a2b8';
    else if (status.includes('maintenance')) color = '#ffc107';
    else if (status.includes('charging')) color = '#FF7F00';

    const marker = L.circleMarker([vehicle.last_latitude, vehicle.last_longitude], {
      radius: 8,
      fillColor: color,
      color: '#fff',
      weight: 2,
      opacity: 1,
      fillOpacity: 0.8
    }).addTo(map);

    marker.bindTooltip(vehicle.serial_number);
    marker.on('click', () => showVehicleDetails(vehicle));
    vehicleMarkers[vehicle.id] = marker;
  }

  function showVehicleDetails(vehicle) {
    selectedVehicleId = vehicle.id;

    $('#detail-serial').text(vehicle.serial_number);
    $('#detail-type').text(vehicle.type || vehicle.vehicle_type || 'Unknown');
    $('#detail-status').html(`
      <span class="status-badge ${(vehicle.status || '').toLowerCase().replace(' ', '-')}">
        ${vehicle.status || 'Unknown'}
      </span>
    `);
    $('#detail-battery').text(`${vehicle.battery_level || vehicle.battery || 0}%`);
    $('#detail-location').text(vehicle.location || 'Unknown');
    $('#detail-last-updated').text(formatTime(vehicle.last_updated?.toDate() || new Date()));
    $('#detail-coordinates').text(`
      ${vehicle.last_latitude || 'N/A'}, ${vehicle.last_longitude || 'N/A'}
    `);

    loadVehicleActivity(vehicle.id);

    $('#vehicle-details-drawer').addClass('open');
    $('#drawer-backdrop').addClass('show');

    if (vehicle.last_latitude && vehicle.last_longitude) {
      map.setView([vehicle.last_latitude, vehicle.last_longitude], 16);
      vehicleMarkers[vehicle.id]?.openTooltip();
    }
  }

  function loadVehicleActivity(vehicleId) {
    $('#vehicle-timeline').empty();

    db.collection('vehicle_history')
      .where('vehicle_id', '==', vehicleId)
      .orderBy('timestamp', 'desc')
      .limit(5)
      .get()
      .then(querySnapshot => {
        if (querySnapshot.empty) {
          $('#vehicle-timeline').html('<div class="no-results">No recent activity found</div>');
          return;
        }

        querySnapshot.forEach(doc => {
          const activity = doc.data();
          const timestamp = activity.timestamp?.toDate() || new Date();

          const timelineItem = $(`
            <div class="timeline-item">
              <div class="timeline-time">${formatTime(timestamp)}</div>
              <div class="timeline-content">
                ${getActivityDescription(activity)}
              </div>
            </div>
          `);

          $('#vehicle-timeline').append(timelineItem);
        });
      })
      .catch(error => {
        console.error('Error loading vehicle activity:', error);
        $('#vehicle-timeline').html('<div class="no-results">Error loading activity</div>');
      });
  }

  function updateVehicleCounters() {
    const total = allVehicles.length;
    const active = allVehicles.filter(v => v.status === 'In Use').length;
    const maintenance = allVehicles.filter(v => v.status === 'Maintenance').length;

    $('#total-vehicles').text(total);
    $('#active-rides').text(active);
    $('#maintenance-vehicles').text(maintenance);
  }

  function updateAlerts() {
    const lowBatteryVehicles = allVehicles.filter(v => (v.battery_level || v.battery || 0) < 20).length;
    const maintenanceVehicles = allVehicles.filter(v => v.status === 'Maintenance').length;

    $('#low-battery-alert').text(`
      ${lowBatteryVehicles} vehicle${lowBatteryVehicles !== 1 ? 's' : ''} 
      ${lowBatteryVehicles !== 1 ? 'have' : 'has'} battery levels below 20%. 
      Consider sending maintenance team for battery swap.
    `);

    $('#maintenance-alert').text(`
      ${maintenanceVehicles} vehicle${maintenanceVehicles !== 1 ? 's' : ''} 
      require${maintenanceVehicles === 1 ? 's' : ''} maintenance. 
      Check Fleet Management for details.
    `);
  }

  // Helper functions
  function getBatteryClass(level) {
    if (level > 70) return 'battery-high';
    if (level > 30) return 'battery-medium';
    return 'battery-low';
  }

  function formatTime(date) {
    const options = {
      month: 'short',
      day: 'numeric',
      hour: '2-digit',
      minute: '2-digit'
    };
    return date.toLocaleString('en-US', options);
  }

  function getActivityDescription(activity) {
    if (activity.battery_level > 90) {
      return `Battery charged to ${activity.battery_level}%`;
    } else if (activity.status_change === 'Maintenance') {
      return 'Maintenance check completed';
    } else if (activity.status_change === 'In Use') {
      return 'Ride started by user';
    } else if (activity.status_change === 'Available') {
      return 'Ride completed';
    }
    return `Location updated (${activity.battery_level || activity.battery || 0}% battery)`;
  }
</script>
</body>

</html>